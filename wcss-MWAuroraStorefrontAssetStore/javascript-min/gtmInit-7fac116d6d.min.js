jQuery.extend(GTM,{convertLinkParam:"cm_mmc",userLogonId:null,userFirstName:null,userPFAccount:null,promoUrlSeparator:"-_-",isGuest:null,currency:"USD"==international.currSymbol?"$":international.currSymbol,onPageLoadEventData:null,getParamRegExp:function(e){return new RegExp("(?:"+e+")=(.*?)(?:&|\\?|$|#)","i")},pushData:function(e){dataLayer.push(e)},getConvertedPromoUrl:function(e){var t=URI.getQuery(e),e=t.vars[this.convertLinkParam].split(this.promoUrlSeparator);return delete t.vars[this.convertLinkParam],t.vars.utm_source=e[0],t.vars.utm_medium=e[1],t.vars.utm_campaign=e[2],t.vars.utm_term=e[3],URI.getStringFromQuery(t)},getCleanPageTitle:function(){var e=document.title,t=new RegExp("\\s*\\|+\\s*(?:"+this.storeName+")","gi");return e.replace(t,"")},getFilteredPageTitle:function(e){return""==e?this.getCleanPageTitle():e.indexOf(":")==e.length-1?e+" "+this.getCleanPageTitle():e},convertUrl:function(e){var t=this.getParamRegExp(this.convertLinkParam),r=e.match(t),t=e;return t=r&&void 0!==r[1]?this.getConvertedPromoUrl(e):t},joinGiftCardsWithSameAmount:function(e){var t,r,a,i,n,o;if(e){for(n={},o=[],t=0;t<e.length;t++)n[e[t].price]||(n[e[t].price]=[]),n[e[t].price].push(t);for(i in n)if(1<n[i].length)for(e[n[i][0]].quantity=n[i].length,r=n[i].length;r--;)0!=r&&o.push(n[i][r]);for(o.sort(),a=o.length;a--;)e.splice(o[a],1);return e}},isCookieEmpty:function(e){return null==e||e.length<=0},initUserInfo:function(){try{for(var e=null,t=document.cookie.split(";"),r=0;r<t.length;r++){var a=t[r].indexOf("="),i=(i=t[r].substr(0,a)).replace(/^\s+|\s+$/g,"");if("TMWUSERINFO"==i&&(e=unescape(t[r].substr(a+1)),!this.isCookieEmpty(e)))try{var n=e.split("|");this.userLogonId=n[0],this.userFirstName=n[1],this.isGuest="true"!=n[3],this.userPFAccount="null"!=n[9]?n[9]:""}catch(e){}}}catch(e){TB.Utils.isConfirmation()&&gaMeasurementEvent("Error Event",GA_ORDER_ID,GA_REVENUE,e)}},isPDPbeforeLoad:function(){return document.body.classList.contains("pdp")},isPGPbeforeLoad:function(){return document.body.classList.contains("category")},isThematicPage:function(){return document.body.classList.contains("thematic")},getBreadcrump:function(){var e=null;return this.searchTerm&&(e="Search;"+this.searchTerm),this.isPGPbeforeLoad()&&(e=this.gtmBreadCrumb+";"+this.gtmLastBreadCrumb),this.isPDPbeforeLoad()&&(e=this.gtmBreadCrumb+";"+this.productName),e=this.isThematicPage()?this.homeBreadCrumb+jQuery(".breadcrumb-item.current-page").clone().find(".visuallyhidden").empty().parent().text().trim():e},pushOrderConfirm:function(e){var t,r,a,i,n,o=e.order,s=e.order.giftCards.type,u=this.getDataLayerProperty("memberId"),g=o.ecommerce.purchase.actionField.id;if((o.ecommerce.purchase.products.length||o.giftCards.gifts.length)&&localStorage.getItem("puchasedOrderId")!=g){if("undefined"!=typeof QuickInfoJS)for(var m=0;m<o.ecommerce.purchase.products.length;m++){var c=o.ecommerce.purchase.products[m];c.dimension58=QuickInfoJS.getValidCategoryForCheckoutFlow(c.orderItemId)}t=this.joinGiftCardsWithSameAmount(e.order.giftCards.gifts),"E"!=s&&"P"!=s||(n="E"==s?"eGiftcard":"Giftcard",waitForVariable("ga",function(){for(m=0;m<t.length;m++)r=Number(t[m].price),a=Number(t[m].quantity),i="$"+t[m].price,ga("send","event","Ecommerce","purchase",n,r,{metric1:a,dimension23:i})})),Array.isArray(o.giftCards.gifts)&&jQuery.merge(o.ecommerce.purchase.products,o.giftCards.gifts),this.pushData(o),""!=u&&this.pushData({gaUserId:u}),localStorage.setItem("puchasedOrderId",g)}},trackTuxItemsOnShoppingCart:function(e){Array.isArray(e)&&e.length&&this.pushData({event:"tux_products_present",tux_products:e})},getCartData:function(){try{var e,t,r=JSON.parse(localStorage.productsData),a=[],i={grandTotal:String(r.priceTotal)};for(e in r)void 0!==r[e].title&&(t={name:r[e].title,price:String(r[e].itemSubtotalPrice),quantity:r[e].QTY?String(r[e].QTY):"1",orderItemId:e,id:r[e].pNumb,sku:QuickInfoJS.getParamForItemInCart(e,"sku"),categoryId:QuickInfoJS.getParamForItemInCart(e,"categoryId"),dimension58:QuickInfoJS.getParamForItemInCart(e,"validCategoryName")},a.push(t));return i.products=a,i}catch(e){return{}}}}),GTM.initUserInfo();var userId=TB.Utils.getNonGenericUserId()||"-1002",isGuest=GTM.isGuest||null===GTM.isGuest;GTM.onPageLoadEventData={event:"page-load",url:document.location.href,siteEnvironment:GTM.config.siteEnvironment,visitorType:isGuest?"visitor":"member",memberId:isGuest?"":userId,userId:userId};var dataLayer=[GTM.onPageLoadEventData],gtmPageType=GTM.config.gtmPageType,gtmPageNav=GTM.config.gtmPageNav,gtmPageSubNav=GTM.config.gtmPageSubNav;""==gtmPageType&&(gtmPageType=GTM.getCleanPageTitle()),GTM.onPageLoadEventData={event:"page-load",url:document.location.href,siteEnvironment:GTM.config.siteEnvironment,visitorType:isGuest?"visitor":"member",memberId:isGuest?"":userId,userId:userId,name:isGuest?"":GTM.userFirstName,email:"true"==isGuest?"":GTM.userLogonId,rewards_id:isGuest?"":GTM.userPFAccount,pageCategory:GTM.getFilteredPageTitle(GTM.config.gtmPageCategory),pageName:GTM.getFilteredPageTitle(GTM.config.gtmTitle),breadcrumb:GTM.getBreadcrump(),pageType:gtmPageType,pageNav:""==gtmPageNav?gtmPageType:gtmPageNav,pageSubNav:""==gtmPageSubNav?gtmPageType:gtmPageSubNav,cart:GTM.getCartData()},GTM.onPageLoadEventData.platformType="undefined"!=typeof WCParamJS&&WCParamJS.isInStandaloneMode?"PWA":"Web",GTM.config.currentCheckoutStep&&(GTM.onPageLoadEventData.singlePageCheckout=GTM.config.isCurrentStepReview),window.isOutletPDP&&(GTM.onPageLoadEventData.isOutlet=!0),dataLayer=[GTM.onPageLoadEventData],TB.Utils.isConfirmation()&&"undefined"!=typeof orderConfirmObj&&GTM.pushOrderConfirm(orderConfirmObj);try{!function(e,t,r,a){e[r]=e[r]||[],e[r].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});e=t.getElementsByTagName("script")[0],r=t.createElement("script");r.async=!0;t=GTM.getPreviewParams();r.src="//www.googletagmanager.com/gtm.js?id="+a+t,e.parentNode.insertBefore(r,e)}(window,document,"dataLayer",GTM.id)}catch(e){TB.Utils.isConfirmation()&&gaMeasurementEvent("GTM Failed",GA_ORDER_ID,GA_REVENUE,e)}document.getElementById("prod-category").textContent=GTM.getFilteredPageTitle(GTM.config.gtmPageCategory);